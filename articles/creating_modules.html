<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating Modules ‚Ä¢ papercheck</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating Modules">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-160147578-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-160147578-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">papercheck</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9036</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/papercheck.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/scienceverse/papercheck/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Creating Modules</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/scienceverse/papercheck/blob/master/vignettes/creating_modules.Rmd" class="external-link"><code>vignettes/creating_modules.Rmd</code></a></small>
      <div class="d-none name"><code>creating_modules.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/scienceverse/papercheck" class="external-link">papercheck</a></span><span class="op">)</span></span></code></pre></div>
<p>Modules are user-created patterns for checking a paper or set of
papers. Module specifications are written in JSON format.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="dt">"title"</span><span class="fu">:</span> <span class="st">"List All P-Values"</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"List all p-values in the text, returning the matched text (e.g., 'p = 0.04') and document location in a table."</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<div class="section level2">
<h2 id="search-strategies">Search Strategies<a class="anchor" aria-label="anchor" href="#search-strategies"></a>
</h2>
<p>Modules can use three search strategies, each of which has its own
JSON specification. All three types take either a paper object or the
resulting search table as input, making it easy to chain modules
together.</p>
<div class="section level3">
<h3 id="text-search">Text Search<a class="anchor" aria-label="anchor" href="#text-search"></a>
</h3>
<p>For checks that can be done with a simple text search, you can create
a module that provides the arguments to the <code><a href="../reference/search_text.html">search_text()</a></code>
function. The ‚Äútext‚Äù key takes a dictionary of the arguments to the
<code><a href="../reference/search_text.html">search_text()</a></code> function.</p>
<p>Foe example, the following JSON specification defines the arguments
needed to search for all instances of p-values in the text and return
just the matched text.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="dt">"title"</span><span class="fu">:</span> <span class="st">"List All P-Values"</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"List all p-values in the text, returning the matched text (e.g., 'p = 0.04') and document location in a table."</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="dt">"text"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="dt">"pattern"</span><span class="fu">:</span> <span class="st">"</span><span class="ch">\\</span><span class="st">bp-?(value)?</span><span class="ch">\\</span><span class="st">s*[&lt;&gt;=‚â§‚â•]{1,2}</span><span class="ch">\\</span><span class="st">s*(n</span><span class="ch">\\</span><span class="st">.?s</span><span class="ch">\\</span><span class="st">.?|</span><span class="ch">\\</span><span class="st">d?</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">d+)(e-</span><span class="ch">\\</span><span class="st">d+)?"</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="dt">"return"</span><span class="fu">:</span> <span class="st">"match"</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="dt">"perl"</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code">Code<a class="anchor" aria-label="anchor" href="#code"></a>
</h3>
<p>For checks that require a bit more logic, you can include R code
directly or (more likely) reference an external .R file. The ‚Äúcode‚Äù key
takes a dictionary of the ‚Äúcode‚Äù or a ‚Äúpath‚Äù to a file containing code.
You can optionally list the ‚Äúpackages‚Äù required so users can be prompted
to install any unavailable packages.</p>
<pre><code>{
  "title": "Check Status of OSF Links",
  "description": "List all OSF links and whether they are open, closed, or do not exist.",
  "code": {
    "packages": ["papercheck", "httr", "dplyr"],
    "path": "osf-check.R"
  }
}</code></pre>
<p>Code must end with a list that contains values to return. The item
<code>table</code> should be the table of returned values, and the
optional item <code>traffic_light</code> contains the classification of
the result (see below).</p>
</div>
<div class="section level3">
<h3 id="large-language-models">Large Language Models<a class="anchor" aria-label="anchor" href="#large-language-models"></a>
</h3>
<p>The ‚Äúllm‚Äù key takes a dictionary of the arguments to the
<code><a href="../reference/llm.html">llm()</a></code> function.</p>
<pre><code>{
  "title": "Summarise Sections",
  "description": "Generate a 1-sentence summary for each section",
  "llm": {
    "query": "Summarise this section briefly, in one sentence. Do not include any preamble explaining what you are going to do, just give the sentence."
  }
}
</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="chaining-modules">Chaining Modules<a class="anchor" aria-label="anchor" href="#chaining-modules"></a>
</h2>
<p>You can run a chain of modules by including them in order. The first
module will take the paper(s) as input, and the rest will take the
returned table as input. Here, we want to group the text by section
before sending it to the llm.</p>
<pre><code>{
  "title": "Summarise Sections",
  "description": "Generate a 1-sentence summary for each section",
  "text": {
    "return": "section"
  },
  "llm": {
    "query": "Summarise this section briefly, in one sentence. Do not include any preamble explaining what you are going to do, just give the sentence."
  }
}
</code></pre>
</div>
<div class="section level2">
<h2 id="report-info">Report Info<a class="anchor" aria-label="anchor" href="#report-info"></a>
</h2>
<p>If you are using your modules to build a report, you need to specify
what type of output corresponds to good practice or practice that may
need improvement. We do this through ‚Äútraffic-light‚Äù and ‚Äúreport‚Äù
keys.</p>
<div class="section level3">
<h3 id="traffic-lights">Traffic Lights<a class="anchor" aria-label="anchor" href="#traffic-lights"></a>
</h3>
<p>There are 5 kinds of traffic lights:</p>
<style>
  h2.na::before { content: '‚ö™Ô∏è '; }
  h2.fail::before { content: '‚ö´Ô∏è '; }
  h2.info::before { content: 'üîµ '; }
  h2.red::before { content: 'üî¥ '; }
  h2.yellow::before { content: 'üü° '; }
  h2.green::before { content: 'üü¢ '; }
</style>
<p>üü¢ no problems detected;<br> üü° something to check;<br> üî¥ possible
problems detected;<br> üîµ informational only;<br> ‚ö™Ô∏è not applicable;<br>
‚ö´Ô∏è check failed</p>
<p>The simplest way to set traffic lights is to specify the meaning of
‚Äúfound‚Äù and ‚Äúnot_found‚Äù. If the module produces more than 0 rows in the
output table, then the traffic light takes the ‚Äúfound‚Äù value, otherwise
the ‚Äúnot_found‚Äù value.</p>
<pre><code>{
  "title": "List All P-Values",
  "description": "List all p-values in the text, returning the matched text (e.g., 'p = 0.04') and document location in a table.",
  "text": {
    "pattern": "\\bp-?(value)?\\s*[&lt;&gt;=‚â§‚â•]{1,2}\\s*(n\\.?s\\.?|\\d?\\.\\d+)(e-\\d+)?",
    "return": "match",
    "perl": true
  },
  "traffic_light": {
    "found": "info",
    "not_found": "na"
  }
}</code></pre>
<p>If you are using the ‚Äúcode‚Äù type, you can also specify the traffic
light in the returned list.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># code for imprecise-p module</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/module_run.html">module_run</a></span><span class="op">(</span><span class="va">paper</span>, <span class="st">"all-p-values"</span><span class="op">)</span><span class="op">$</span><span class="va">table</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">p_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"p-?(value)?\\s*|\\s*\\d?\\.\\d+e?-?\\d*"</span>, <span class="st">""</span>, <span class="va">p</span><span class="op">$</span><span class="va">text</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">p_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^p-?(value)?\\s*[&lt;&gt;=‚â§‚â•]{1,2}\\s*"</span>, <span class="st">""</span>, <span class="va">p</span><span class="op">$</span><span class="va">text</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">p_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">p_value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">imprecise</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">p_comp</span> <span class="op">==</span> <span class="st">"&lt;"</span> <span class="op">&amp;</span> <span class="va">p</span><span class="op">$</span><span class="va">p_value</span> <span class="op">&gt;</span> <span class="fl">.001</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">imprecise</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">imprecise</span> <span class="op">|</span> <span class="va">p</span><span class="op">$</span><span class="va">p_comp</span> <span class="op">==</span> <span class="st">"&gt;"</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">imprecise</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">imprecise</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">p_value</span><span class="op">)</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"text"</span>, <span class="st">"section"</span>, <span class="st">"header"</span>, <span class="st">"div"</span>, <span class="st">"p"</span>, <span class="st">"s"</span>, <span class="st">"id"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tl</span> <span class="op">&lt;-</span> <span class="st">"na"</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">imprecise</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tl</span> <span class="op">&lt;-</span> <span class="st">"red"</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">imprecise</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tl</span> <span class="op">&lt;-</span> <span class="st">"green"</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">tl</span> <span class="op">&lt;-</span> <span class="st">"yellow"</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  table <span class="op">=</span> <span class="va">p</span><span class="op">[</span><span class="va">p</span><span class="op">$</span><span class="va">imprecise</span>, <span class="va">cols</span><span class="op">]</span>,</span>
<span>  traffic_light <span class="op">=</span> <span class="va">tl</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="report">Report<a class="anchor" aria-label="anchor" href="#report"></a>
</h3>
<p>Any text that you want to include in the report should be specified
in the ‚Äúreport‚Äù key. You can set different text for each traffic light,
and/or text to include in all reports.</p>
<pre><code>{
  "title": "Reference Consistency",
  "description": "Check if all references are cited and all citations are referenced",
  "code": {
    "packages": ["dplyr"],
    "path": "ref-consistency.R"
  },
  "report": {
    "all": "This module relies on Grobid correctly parsing the references. There may be some false positives.",
    "red": "There are references that are not cited or citations that are not referenced",
    "green": "All references were cited and citations were referenced",
    "na": "No citations/references were detected"
  }
}</code></pre>
</div>
<div class="section level3">
<h3 id="authors">Authors<a class="anchor" aria-label="anchor" href="#authors"></a>
</h3>
<p>You can also include author information in the following format:</p>
<pre><code>{
  "title": "List All P-Values",
  "description": "List all p-values in the text, returning the matched text (e.g., 'p = 0.04') and document location in a table.",
  "authors": [{
    "orcid": "0000-0002-7523-5539",
    "name":{
      "surname": "DeBruine",
      "given": "Lisa"
    },
    "email": "debruine@gmail.com"
  }],
  "text": {
    "pattern": "\\bp-?(value)?\\s*[&lt;&gt;=‚â§‚â•]{1,2}\\s*(n\\.?s\\.?|\\d?\\.\\d+)(e-\\d+)?",
    "return": "match",
    "perl": true
  },
  "traffic_light": {
    "found": "info",
    "not_found": "na"
  }
}</code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lisa DeBruine, Daniel Lakens.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
